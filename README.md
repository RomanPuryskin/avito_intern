# avito_intern

Запуск сервиса командой docker-compose up со значениями по умолчанию
Если нужно запустить сервис со своими значениями, то скопировать содержимое файла example.env в файл .env в корень проекта и заменить значения с пометкой YOUR_ на свои

Вариант запуска без docker (с помощью Makefile):
- make run  //  создасться папка .bin в корне проекта с бинарником проекта и запустится

вопросы с которыми столкнулся:

 1)проблема: В Open api видим, что при попытке ввести команду, которая уже существует, выходим с ошибкой 400, значит ввести такое же название для реактирования команды не получится. Значит сделаем так: при создании команды, пользователи уже будут закреплены за ней и не смогут попасть в дргую команду или быть отредактированы(поменялся никнейм например), но при удалении команды, пользователи будут удалены из базы (ON DELETE CASCADE в БД), значит при создании новой команды их снова можно будет ввести.  Так же username пользователя будет уникальный (что логично),  тогда при создании новой команды нужно провалидировать 3 пункта:
 - для каждого пользователя при регистрации команды посмотреть, что пользователь с таким user_id не создан
 - для каждого пользователя при регистрации команды посмотреть, что пользователь с таким username не создан
 - в одной команде нельзя создать двух пользователей с одним user_id или username

2)проблема: у меня есть разделение на слои (репозиторий -> сервис -> хэндлер) . Репозитории тоже разные (User , team, pr) Вопрос: как например в сервисе team сделать операцию createTeam, если для этого нужно использовать и методы из user repository и методы из teamrepository, более того, нужно сделать это атомарно ( используя транзакции),  но если мы в методах интерфейсов user и team будем принимать pgx.Tx( для postgres), то мы будем жестко привязаны к postgres и смысла от интерфейсов не будет. Решение: передавать транзакцию через контекст и получать ее из контекста на месте, но для управления транзакциями сервис тоже должен иметь connection к БД.

3)проблема: как хранить массив assigned_reviewers у pull_request? 
Я нормализовал БД и создал отельную табличку(assigned_reviewers), которая хранит связь многие ко многим (pull_request_id - user_id)

4)проблема: не хватало статус кодов для ошибок и я добавил:
 - INVALID_INPUT для того, чтобы сообщить что данные запроса некорректные ( нарушена структура json, сообщение "invalid input" или отсутствуют необходимые поля, сообщение "invalid input format" )
 - USER_EXISTS существования пользователя при создании команды (для проблемы 1)
 - INTERNAL_SERVER чтобы сообщить о проблеме на сервере (при обращении к БД)

5)проблема: для удобной валидации запросов на корректность и удобного ответа так же описал несколько моделей ( все модели находятся в ./internal/enteties )
